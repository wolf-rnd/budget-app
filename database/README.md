# ×ž×¡×“ × ×ª×•× ×™× ×œ×ž×¢×¨×›×ª ×ª×§×¦×™×‘ ×ž×©×¤×—×ª×™

## ðŸ“‹ ×ª×™××•×¨ ×›×œ×œ×™

×ž×¡×“ × ×ª×•× ×™× PostgreSQL ×ž×ª×§×“× ×œ× ×™×”×•×œ ×ª×§×¦×™×‘ ×ž×©×¤×—×ª×™ ×¢× ×ª×ž×™×›×” ×ž×œ××” ×‘×©× ×•×ª ×ª×§×¦×™×‘, ×§×•×¤×•×ª, ×”×›× ×¡×•×ª, ×”×•×¦××•×ª, ×ž×¢×©×¨×•×ª, ×—×•×‘×•×ª ×•×ž×©×™×ž×•×ª.

## ðŸ—„ï¸ ×ž×‘× ×” ×”×˜×‘×œ××•×ª

### ×˜×‘×œ××•×ª ×œ×™×‘×”

#### `users` - ×ž×©×ª×ž×©×™×
- **×ª×¤×§×™×“**: × ×™×”×•×œ ×ž×©×ª×ž×©×™ ×”×ž×¢×¨×›×ª
- **×©×“×•×ª ×¢×™×§×¨×™×™×**: email, password_hash, first_name, last_name
- **××‘×˜×—×”**: ×”×¦×¤× ×ª ×¡×™×¡×ž××•×ª, ××™×ž×™×™×œ×™× ×™×™×—×•×“×™×™×

#### `budget_years` - ×©× ×•×ª ×ª×§×¦×™×‘
- **×ª×¤×§×™×“**: ×”×’×“×¨×ª ×ª×§×•×¤×•×ª ×ª×§×¦×™×‘ ×’×ž×™×©×•×ª
- **×©×“×•×ª ×¢×™×§×¨×™×™×**: name, start_date, end_date, is_active
- **××™×œ×•×¦×™×**: ×ª××¨×™×š ×¡×™×•× ××—×¨×™ ×ª×—×™×œ×”, ×©× ×” ×¤×¢×™×œ×” ××—×ª ×œ×ž×©×ª×ž×©

#### `funds` - ×§×•×¤×•×ª (×”×’×“×¨×•×ª ×‘×¡×™×¡)
- **×ª×¤×§×™×“**: ×”×’×“×¨×ª ×¡×•×’×™ ×§×•×¤×•×ª ×•×ª×›×•× ×•×ª×™×”×Ÿ
- **×©×“×•×ª ×¢×™×§×¨×™×™×**: name, type, level, include_in_budget
- **×¡×•×’×™×**: monthly, annual, savings

#### `fund_budgets` - ×ª×§×¦×™×‘×™ ×§×•×¤×•×ª
- **×ª×¤×§×™×“**: ×§×™×©×•×¨ ×§×•×¤×•×ª ×œ×©× ×•×ª ×ª×§×¦×™×‘ ×¢× ×¡×›×•×ž×™×
- **×©×“×•×ª ×¢×™×§×¨×™×™×**: amount, amount_given, spent
- **×™×—×¡×™×**: fund_id â†” budget_year_id

### ×˜×‘×œ××•×ª ×ª×•×›×Ÿ

#### `categories` - ×§×˜×’×•×¨×™×•×ª
- **×ª×¤×§×™×“**: ×¡×™×•×•×’ ×”×•×¦××•×ª ×•×§×™×©×•×¨ ×œ×§×•×¤×•×ª
- **×©×“×•×ª ×¢×™×§×¨×™×™×**: name, fund_id, color_class
- **×¢×™×¦×•×‘**: ×ª×ž×™×›×” ×‘×¦×‘×¢×™ Tailwind

#### `incomes` - ×”×›× ×¡×•×ª
- **×ª×¤×§×™×“**: ×¨×™×©×•× ×”×›× ×¡×•×ª ×¢× ×§×™×©×•×¨ ×œ×©× ×ª ×ª×§×¦×™×‘
- **×©×“×•×ª ×¢×™×§×¨×™×™×**: name, amount, source, date
- **×—×™×©×•×‘×™×**: month, year ××•×˜×•×ž×˜×™×™×

#### `expenses` - ×”×•×¦××•×ª
- **×ª×¤×§×™×“**: ×¨×™×©×•× ×”×•×¦××•×ª ×¢× ×§×™×©×•×¨ ×œ×§×˜×’×•×¨×™×” ×•×§×•×¤×”
- **×©×“×•×ª ×¢×™×§×¨×™×™×**: name, amount, category_id, fund_id, date
- **××™×œ×•×¦×™×**: ×ž× ×™×¢×ª ×ž×—×™×§×ª ×§×˜×’×•×¨×™×•×ª/×§×•×¤×•×ª ×‘×©×™×ž×•×©

#### `tithe_given` - ×ž×¢×©×¨×•×ª ×©× ×™×ª× ×•
- **×ª×¤×§×™×“**: ×ž×¢×§×‘ ××—×¨ ×ž×¢×©×¨×•×ª ×•×¦×“×§×”
- **×©×“×•×ª ×¢×™×§×¨×™×™×**: description, amount, date
- **×—×™×©×•×‘×™×**: ×œ× ×ž×•×’×‘×œ ×œ×©× ×ª ×ª×§×¦×™×‘ ×¡×¤×¦×™×¤×™×ª

#### `debts` - ×—×•×‘×•×ª
- **×ª×¤×§×™×“**: × ×™×”×•×œ ×—×•×‘×•×ª ×“×•-×›×™×•×•× ×™×™×
- **×©×“×•×ª ×¢×™×§×¨×™×™×**: description, amount, type, is_paid
- **×¡×•×’×™×**: owed_to_me, i_owe

#### `tasks` - ×ž×©×™×ž×•×ª
- **×ª×¤×§×™×“**: × ×™×”×•×œ ×ª×–×›×•×¨×•×ª ×•×ž×©×™×ž×•×ª
- **×©×“×•×ª ×¢×™×§×¨×™×™×**: description, completed, important
- **×ž×¢×§×‘**: completed_at ××•×˜×•×ž×˜×™

### ×˜×‘×œ××•×ª ×ž×ª×§×“×ž×•×ª

#### `asset_snapshots` + `asset_details` - × ×›×¡×™×
- **×ª×¤×§×™×“**: ×ª×ž×•× ×•×ª ×ž×¦×‘ ×ª×§×•×¤×ª×™×•×ª ×©×œ × ×›×¡×™× ×•×”×ª×—×™×™×‘×•×™×•×ª
- **×ž×‘× ×”**: snapshot ×¨××©×™ + ×¤×™×¨×•×˜ × ×›×¡×™×
- **×’×ž×™×©×•×ª**: ×ª×ž×™×›×” ×‘×¡×•×’×™ × ×›×¡×™× ×“×™× ×ž×™×™×

#### `system_settings` - ×”×’×“×¨×•×ª ×ž×¢×¨×›×ª
- **×ª×¤×§×™×“**: ×”×’×“×¨×•×ª ×’×ž×™×©×•×ª ×œ×ž×©×ª×ž×©
- **×©×“×•×ª ×¢×™×§×¨×™×™×**: setting_key, setting_value, data_type
- **×¡×•×’×™ × ×ª×•× ×™×**: string, number, boolean, json

## ðŸ”— ×§×©×¨×™ ×’×•×ž×œ×™×Ÿ

### ×™×—×¡×™× ×¢×™×§×¨×™×™×
```
users (1) â†â†’ (âˆž) budget_years
users (1) â†â†’ (âˆž) funds
funds (1) â†â†’ (âˆž) fund_budgets (âˆž) â†â†’ (1) budget_years
funds (1) â†â†’ (âˆž) categories
categories (1) â†â†’ (âˆž) expenses
budget_years (1) â†â†’ (âˆž) incomes
budget_years (1) â†â†’ (âˆž) expenses
```

### ××™×œ×•×¦×™ ×©×œ×ž×•×ª
- **CASCADE**: ×ž×—×™×§×ª ×ž×©×ª×ž×© ×ž×•×—×§×ª ××ª ×›×œ ×”× ×ª×•× ×™×
- **RESTRICT**: ×ž× ×™×¢×ª ×ž×—×™×§×ª ×§×˜×’×•×¨×™×•×ª/×§×•×¤×•×ª ×‘×©×™×ž×•×©
- **UNIQUE**: ×©×ž×•×ª ×™×™×—×•×“×™×™×, ×©× ×” ×¤×¢×™×œ×” ××—×ª

## âš¡ ×‘×™×¦×•×¢×™× ×•××•×¤×˜×™×ž×™×–×¦×™×”

### ××™× ×“×§×¡×™× ××¡×˜×¨×˜×’×™×™×
- **user_id**: ×‘×›×œ ×˜×‘×œ×” ×œ×¡×™× ×•×Ÿ ×ž×”×™×¨
- **×ª××¨×™×›×™×**: ×œ×—×™×¤×•×©×™× ×‘×˜×•×•×—×™ ×–×ž×Ÿ
- **×ž×¦×‘×™×**: completed, is_active, type
- **×—×™×¤×•×©×™×**: source, category_id, fund_id

### ×¤×•× ×§×¦×™×•×ª ×ž×•×›× ×•×ª
- `get_total_income_for_budget_year()` - ×¡×”"×› ×”×›× ×¡×•×ª ×œ×©× ×”
- `get_total_expenses_for_budget_year()` - ×¡×”"×› ×”×•×¦××•×ª ×œ×©× ×”
- `get_total_budget_for_budget_year()` - ×¡×”"×› ×ª×§×¦×™×‘ ×œ×©× ×”
- `get_total_tithe_given()` - ×¡×”"×› ×ž×¢×©×¨×•×ª
- `get_total_income_for_tithe()` - ×”×›× ×¡×•×ª ×œ×ž×¢×©×¨×•×ª

### Views ×ž×•×¨×›×‘×•×ª
- `budget_year_summary` - ×¡×™×›×•× ×ž×œ× ×œ×©× ×ª ×ª×§×¦×™×‘
- `fund_summary` - ×ž×¦×‘ ×§×•×¤×•×ª ×¢× ×™×ª×¨×•×ª
- `expenses_by_category` - ×”×•×¦××•×ª ×ž×§×•×‘×¦×•×ª

## ðŸ›¡ï¸ ××‘×˜×—×” ×•××ž×™× ×•×ª

### ×”×’× ×•×ª ×ž×•×‘× ×•×ª
- **Triggers**: ×¢×“×›×•×Ÿ updated_at ××•×˜×•×ž×˜×™
- **Check constraints**: ×¢×¨×›×™× ×—×™×•×‘×™×™×, ×˜×•×•×—×™ ×ª××¨×™×›×™×
- **Foreign keys**: ×©×œ×ž×•×ª ×”×ª×™×™×—×¡×•×™×•×ª
- **Unique constraints**: ×ž× ×™×¢×ª ×›×¤×™×œ×•×™×•×ª

### × ×™×”×•×œ ×©×’×™××•×ª
- **DEFERRABLE**: ××™×œ×•×¦×™× ×’×ž×™×©×™× ×œ×¢×“×›×•× ×™× ×ž×•×¨×›×‘×™×
- **COALESCE**: ×˜×™×¤×•×œ ×‘-NULL ×‘×—×™×©×•×‘×™×
- **Error handling**: ×‘×¤×•× ×§×¦×™×•×ª PL/pgSQL

## ðŸš€ ×”×ª×§× ×” ×•×©×™×ž×•×©

### ×”×¨×¦×ª ×”×¡×›×ž×”
```sql
-- ×”×¨×¦×ª ×§×•×‘×¥ ×”×¡×›×ž×” ×”×ž×œ×
\i database/schema.sql
```

### × ×ª×•× ×™ ×“×ž×•
×”×¡×›×ž×” ×›×•×œ×œ×ª × ×ª×•× ×™ ×“×ž×• ×ž×œ××™×:
- ×ž×©×ª×ž×© ×“×ž×•
- 2 ×©× ×•×ª ×ª×§×¦×™×‘
- 5 ×§×•×¤×•×ª ×¢× ×ª×§×¦×™×‘×™×
- ×§×˜×’×•×¨×™×•×ª ×¦×‘×¢×•× ×™×•×ª
- ×”×’×“×¨×•×ª ×ž×¢×¨×›×ª ×‘×¡×™×¡×™×•×ª

### ×—×™×‘×•×¨ ×œ××¤×œ×™×§×¦×™×”
```javascript
// ×“×•×’×ž×” ×œ×—×™×‘×•×¨
const { Pool } = require('pg');
const pool = new Pool({
  connectionString: process.env.DATABASE_URL
});
```

## ðŸ“Š ×“×•×’×ž××•×ª ×©××™×œ×ª×•×ª

### ×¡×™×›×•× ×©× ×ª ×ª×§×¦×™×‘
```sql
SELECT * FROM budget_year_summary 
WHERE user_id = $1 AND is_active = TRUE;
```

### ×”×•×¦××•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×”
```sql
SELECT * FROM expenses_by_category 
WHERE user_id = $1 AND budget_year_id = $2
ORDER BY total_amount DESC;
```

### ×™×ª×¨×•×ª ×§×•×¤×•×ª
```sql
SELECT * FROM fund_summary 
WHERE user_id = $1 AND budget_year_id = $2
ORDER BY level, fund_name;
```

## ðŸ”„ ×ª×—×–×•×§×” ×•×©×“×¨×•×’×™×

### ×’×™×‘×•×™×™×
```bash
# ×’×™×‘×•×™ ×ž×œ×
pg_dump -h localhost -U username -d database_name > backup.sql

# ×©×—×–×•×¨
psql -h localhost -U username -d database_name < backup.sql
```

### ×ž×™×’×¨×¦×™×•×ª
- ×©×ž×™×¨×ª ×ž×‘× ×” ×’×¨×¡××•×ª
- ×¡×§×¨×™×¤×˜×™× ×œ×©×“×¨×•×’×™×
- ×‘×“×™×§×•×ª ×©×œ×ž×•×ª × ×ª×•× ×™×

×”×ž×¡×“ ×ž×ª×•×›× ×Ÿ ×œ×ª×ž×™×›×” ×ž×œ××” ×‘×›×œ ×”×¤×™×¦'×¨×™× ×”×§×™×™×ž×™× ×•×”×¢×ª×™×“×™×™× ×©×œ ×”×ž×¢×¨×›×ª! ðŸŽ¯